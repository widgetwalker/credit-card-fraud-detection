# Deployment Configuration for Fraud Detection System

# Environment Configuration
environment:
  name: "production"  # development, staging, production
  debug: false
  log_level: "INFO"
  
# Application Configuration
app:
  name: "fraud-detection-api"
  version: "1.0.0"
  port: 8000
  host: "0.0.0.0"
  workers: 4
  timeout: 30
  
# Model Configuration
model:
  default_threshold: 0.5
  max_features: 50
  cache_predictions: true
  cache_ttl: 3600  # seconds
  
# Data Configuration
data:
  max_batch_size: 1000
  validation_enabled: true
  anonymize_data: true
  
# Security Configuration
security:
  enable_auth: true
  api_key_header: "X-API-Key"
  rate_limit:
    enabled: true
    requests_per_minute: 100
    burst_size: 20
  cors:
    enabled: true
    origins: ["*"]
    methods: ["GET", "POST", "PUT", "DELETE"]
    headers: ["*"]
  
# Monitoring Configuration
monitoring:
  enabled: true
  metrics_endpoint: "/metrics"
  health_endpoint: "/health"
  prometheus_enabled: true
  grafana_enabled: true
  
# Logging Configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file_enabled: true
  file_path: "/app/logs/app.log"
  max_file_size: "10MB"
  backup_count: 5
  
# Database Configuration (if needed)
database:
  enabled: false
  type: "postgresql"
  host: "localhost"
  port: 5432
  name: "fraud_detection"
  user: "fraud_user"
  password: "${DB_PASSWORD}"
  pool_size: 10
  
# Redis Configuration (for caching)
redis:
  enabled: true
  host: "redis"
  port: 6379
  db: 0
  password: "${REDIS_PASSWORD}"
  socket_timeout: 5
  connection_pool_size: 10
  
# Docker Configuration
docker:
  image_name: "fraud-detection-api"
  image_tag: "latest"
  registry: ""  # Leave empty for local deployment
  build_args:
    - "PYTHON_VERSION=3.9"
    - "APP_USER=fraud-detection"
  
# Kubernetes Configuration
kubernetes:
  namespace: "fraud-detection"
  replicas: 3
  service_type: "ClusterIP"
  ingress_enabled: true
  ingress_class: "nginx"
  ssl_enabled: true
  cert_manager_issuer: "letsencrypt-prod"
  
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"
  
  autoscaling:
    enabled: true
    min_replicas: 2
    max_replicas: 10
    target_cpu_utilization: 70
    target_memory_utilization: 80
  
  health_check:
    liveness_probe:
      path: "/health"
      port: 8000
      initial_delay_seconds: 30
      period_seconds: 10
      timeout_seconds: 5
      failure_threshold: 3
    readiness_probe:
      path: "/health"
      port: 8000
      initial_delay_seconds: 10
      period_seconds: 5
      timeout_seconds: 3
      failure_threshold: 3
  
# Nginx Configuration
nginx:
  enabled: true
  image: "nginx:alpine"
  config_map: "nginx-config"
  
  rate_limiting:
    enabled: true
    requests_per_second: 10
    burst_size: 20
    nodelay: true
  
  ssl:
    enabled: true
    redirect_http_to_https: true
    hsts_enabled: true
    hsts_max_age: 31536000
  
  security_headers:
    - "X-Frame-Options: DENY"
    - "X-Content-Type-Options: nosniff"
    - "X-XSS-Protection: 1; mode=block"
    - "Referrer-Policy: strict-origin-when-cross-origin"
  
# Prometheus Configuration
prometheus:
  enabled: true
  image: "prom/prometheus:latest"
  port: 9090
  retention_time: "15d"
  scrape_interval: "15s"
  
  rules:
    - name: "fraud_detection_alerts"
      rules:
        - alert: "HighErrorRate"
          expr: "rate(http_requests_total{status=~\"5..\"}[5m]) > 0.1"
          for: "5m"
          labels:
            severity: "warning"
          annotations:
            summary: "High error rate detected"
        
        - alert: "HighLatency"
          expr: "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.5"
          for: "5m"
          labels:
            severity: "warning"
          annotations:
            summary: "High latency detected"
  
# Grafana Configuration
grafana:
  enabled: true
  image: "grafana/grafana:latest"
  port: 3000
  admin_user: "admin"
  admin_password: "${GRAFANA_PASSWORD}"
  
  dashboards:
    - name: "fraud-detection-overview"
      file: "dashboards/fraud_detection_overview.json"
    - name: "system-metrics"
      file: "dashboards/system_metrics.json"
  
# Backup Configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention_days: 30
  
  targets:
    - type: "models"
      path: "/app/models"
      destination: "s3://fraud-detection-backups/models"
    
    - type: "logs"
      path: "/app/logs"
      destination: "s3://fraud-detection-backups/logs"
  
# Alerting Configuration
alerting:
  enabled: true
  
  email:
    enabled: true
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    username: "${ALERT_EMAIL_USER}"
    password: "${ALERT_EMAIL_PASSWORD}"
    from_address: "alerts@fraud-detection.com"
    to_addresses: ["admin@fraud-detection.com"]
  
  slack:
    enabled: false
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channel: "#fraud-detection-alerts"
  
  pagerduty:
    enabled: false
    service_key: "${PAGERDUTY_SERVICE_KEY}"
  
# Environment-specific overrides
development:
  app:
    debug: true
    log_level: "DEBUG"
  
  security:
    enable_auth: false
    rate_limit:
      enabled: false
  
  monitoring:
    enabled: false
  
  docker:
    image_tag: "dev"
  
  kubernetes:
    replicas: 1
    ingress_enabled: false
    ssl_enabled: false

staging:
  app:
    debug: false
    log_level: "INFO"
  
  security:
    enable_auth: true
    rate_limit:
      enabled: true
      requests_per_minute: 200
  
  monitoring:
    enabled: true
  
  docker:
    image_tag: "staging"
  
  kubernetes:
    replicas: 2
    ingress_enabled: true
    ssl_enabled: true
    cert_manager_issuer: "letsencrypt-staging"

production:
  app:
    debug: false
    log_level: "WARNING"
  
  security:
    enable_auth: true
    rate_limit:
      enabled: true
      requests_per_minute: 100
  
  monitoring:
    enabled: true
  
  docker:
    image_tag: "latest"
  
  kubernetes:
    replicas: 3
    ingress_enabled: true
    ssl_enabled: true
    cert_manager_issuer: "letsencrypt-prod"
    
    resources:
      requests:
        cpu: "200m"
        memory: "512Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"